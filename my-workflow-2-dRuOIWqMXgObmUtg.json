{"createdAt":"2025-07-04T16:37:20.081Z","updatedAt":"2025-07-04T17:14:33.674Z","id":"dRuOIWqMXgObmUtg","name":"My workflow 2","active":false,"isArchived":true,"nodes":[{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.message.voice.file_id }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Voice"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8c844924-b2ed-48b0-935c-c66a8fd0c778","leftValue":"={{ $json.message.text }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Text"}]},"options":{}},"id":"c247cbb0-80c8-4116-a957-6aae4d10ddb8","name":"Switch","type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-780,180]},{"parameters":{"chatId":"={{ $('Memoty_RAG_bot').item.json.message.chat.id }}","text":"={{ $json.output }}","additionalFields":{"appendAttribution":false}},"id":"30f1ee70-208d-42af-a4d2-fa5f4cd3739a","name":"Response","type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[520,180],"webhookId":"ac2c424d-f210-4300-8535-22b21bb1905f"},{"parameters":{"resource":"file","fileId":"={{ $json.message.voice.file_id }}"},"id":"abc06902-6fd3-45bf-8939-a70a05dacef7","name":"Download File","type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-520,20],"webhookId":"44f2baa4-d47e-46e0-948b-d4bdd74e9d8b"},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"id":"c187c9fe-9900-414a-9974-7ae127c66f62","name":"Transcribe","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.6,"position":[-380,20]},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[380,760],"id":"5b460ddc-dabe-40a2-89e5-3f5dd1a5e6ca","name":"Embeddings OpenAI"},{"parameters":{"tableId":"chat_logs","fieldsUi":{"fieldValues":[{"fieldId":"session_id","fieldValue":"={{ $json.sessionId }}"},{"fieldId":"user_id","fieldValue":"={{ $json.user_id || $json.message.from.id }}"},{"fieldId":"username","fieldValue":"={{ $json.username || $json.message.from.username }}"},{"fieldId":"role","fieldValue":"user"},{"fieldId":"content","fieldValue":"={{ $json.text }}"},{"fieldId":"metadata","fieldValue":"={{ JSON.stringify($json) }}"},{"fieldId":"first_name","fieldValue":"={{ $json.first_name || $json.message.from.first_name }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-360,260],"id":"ee1092bd-04f5-4938-a881-4fd1479094d0","name":"Save User Message"},{"parameters":{"tableId":"chat_logs","fieldsUi":{"fieldValues":[{"fieldId":"session_id","fieldValue":"={{ $('Set Final Text').item.json.sessionId }}"},{"fieldId":"user_id","fieldValue":"={{ $('Set Final Text').item.json.user_id }}"},{"fieldId":"username","fieldValue":"={{ $('Set Final Text').item.json.username }}"},{"fieldId":"role","fieldValue":"assistant"},{"fieldId":"content","fieldValue":"={{ $('ИНФО АГЕНТ').item.json.output }}"},{"fieldId":"metadata","fieldValue":"={{ JSON.stringify($('Set Final Text').item.json.update || $('Set Final Text').item.json) }}"},{"fieldId":"first_name","fieldValue":"={{ $('Set Final Text').item.json.first_name }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[740,180],"id":"12b1d9b9-1edc-4afb-8579-a123fc9a2496","name":"Save Bot Message"},{"parameters":{"promptType":"define","text":"={{ $('Set Final Text').item.json.text }}","options":{"systemMessage":"You exist to help people implement automations and use AI solutions in life and business. Your job is to uncover the user's problem or question and provide a clear answer using your memory.\n\nIMPORTANT:\n\nYou don’t make things up. You use your knowledge base (via the DATA_TOOL) to retrieve relevant info and insights.\n\nConversation Flow:\n\nMake sure the person has entered the chat with a specific goal or a desire to learn something new.\n\nUnderstand their current situation. If they have a business, ask about its stage, challenges, or questions.\nExample: “Describe what’s going on in your project.”\n\nUnderstand their goal (if they have one) and what’s blocking it.\nExample: “What are you struggling with? What do you think is holding you back?”\n\nConfirm that you can help. Use the knowledge base to find relevant answers or insights that could move them forward.\n\nOffer a clear plan. Suggest actionable solutions that directly match their request. Explain what can be done and how.\n\nAlways end with a question or call to action, so the dialogue doesn’t hit a dead end.\n\nTone & Style:\n\nTalk in a way that even a kid or grandparent can understand. AI is a tough topic for many, so avoid heavy jargon.\n\nUse real-life examples and analogies to explain complex tools and ideas.\n\nStick to the structured conversation flow.\n\nResponse Format:\n\nYou're chatting in Telegram. Send replies in Markdown format optimized for messaging.\n\nMake the text easy and pleasant to read. Use formatting to guide attention.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-80,180],"id":"f9999f5c-53ff-4994-88d3-6902c6c2094e","name":"ИНФО АГЕНТ","retryOnFail":false},{"parameters":{"tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"options":{"queryName":"match_documents"}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1,"position":[220,640],"id":"034b85f2-ba3e-4d29-a66a-681d4f623294","name":"DATA BASE"},{"parameters":{"name":"documents","description":"Provide a detailed and fact-based answer. Use the database as long-term memory, which contains real examples of how AI solutions have been implemented in businesses. Include evaluations, results, and future forecasts where available. Always mention specific project or company names if they are present in the data. Do not generalize — stick to concrete cases.","topK":"=30"},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1,"position":[220,380],"id":"57d35e75-fdfb-456e-ac6f-266c45998b11","name":"DATA_TOOL"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $json.session_id }}","contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[40,380],"id":"88fb4dae-ac0e-4732-bffa-f1e508d2e94e","name":"ВРЕМЕННАЯ ПАМЯТЬ 1"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o","mode":"list","cachedResultName":"gpt-4o"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-80,380],"id":"20bb1a3d-a99e-4e16-86a0-0366367cc493","name":"МОЗГ 1"},{"parameters":{"method":"POST","url":"https://api.telegram.org/bot7631057411:AAHYwct818ewSEeKaM8ViLFIZXn_25Xawco/sendChatAction","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"chat_id\": {{ $('Memoty_RAG_bot').item.json.message.chat.id }},\n  \"action\": \"typing\"\n}\n","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[0,0],"id":"1a7cc3f3-db21-41b4-9b78-37e8429e75c1","name":"Typing 1"},{"parameters":{"assignments":{"assignments":[{"id":"fe7ecc99-e1e8-4a5e-bdd6-6fce9757b234","name":"text","value":"={{ $json.text || $json.message.text }}","type":"string"},{"id":"8386c97a-d1b9-4000-9e17-86c2158e91af","name":"sessionId","value":"={{ 'user_' + $('Switch').item.json.message.from.id }}","type":"string"},{"id":"877d9358-6785-4299-be83-7c78fd41924f","name":"user_id","value":"={{ $('Memoty_RAG_bot').item.json.message.from.id }}","type":"string"},{"id":"c58ae87e-c307-4af6-945f-bb8350aafc3d","name":"username","value":"={{ $('Memoty_RAG_bot').item.json.message.from.username }}","type":"string"},{"id":"a44439db-9b02-4093-9cc9-19af6c9e1a3c","name":"first_name","value":"={{ $('Memoty_RAG_bot').item.json.message.from.first_name }}","type":"string"},{"id":"d65b621c-b717-408d-b88c-20690ebb9b90","name":"update","value":"={{ $('Memoty_RAG_bot').item.json }}","type":"string"}]},"includeOtherFields":true,"options":{}},"id":"08f35250-420d-4f37-a001-74a41ca16950","name":"Set Final Text","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-520,260]},{"parameters":{"model":{"__rl":true,"value":"openai/gpt-4o-mini","mode":"list","cachedResultName":"openai/gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[380,500],"id":"7576b591-7fef-4a55-9e70-3001492a3a70","name":"4o-mini"},{"parameters":{"updates":["message"],"additionalFields":{}},"id":"caca71ea-c7c6-4b90-aeb1-a7bf0b041729","name":"Memoty_RAG_bot","type":"n8n-nodes-base.telegramTrigger","typeVersion":1.1,"position":[-960,180],"webhookId":"6ed50111-9b95-44be-8e88-e23ffaf4610d"}],"connections":{"Switch":{"main":[[{"node":"Download File","type":"main","index":0}],[{"node":"Set Final Text","type":"main","index":0}]]},"Download File":{"main":[[{"node":"Transcribe","type":"main","index":0}]]},"Transcribe":{"main":[[{"node":"Set Final Text","type":"main","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"DATA BASE","type":"ai_embedding","index":0}]]},"Save User Message":{"main":[[{"node":"ИНФО АГЕНТ","type":"main","index":0},{"node":"Typing 1","type":"main","index":0}]]},"Response":{"main":[[{"node":"Save Bot Message","type":"main","index":0}]]},"ИНФО АГЕНТ":{"main":[[{"node":"Response","type":"main","index":0}]]},"DATA BASE":{"ai_vectorStore":[[{"node":"DATA_TOOL","type":"ai_vectorStore","index":0}]]},"DATA_TOOL":{"ai_tool":[[{"node":"ИНФО АГЕНТ","type":"ai_tool","index":0}]]},"ВРЕМЕННАЯ ПАМЯТЬ 1":{"ai_memory":[[{"node":"ИНФО АГЕНТ","type":"ai_memory","index":0}]]},"МОЗГ 1":{"ai_languageModel":[[{"node":"ИНФО АГЕНТ","type":"ai_languageModel","index":0}]]},"Set Final Text":{"main":[[{"node":"Save User Message","type":"main","index":0}]]},"4o-mini":{"ai_languageModel":[[{"node":"DATA_TOOL","type":"ai_languageModel","index":0}]]},"Memoty_RAG_bot":{"main":[[{"node":"Switch","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"f0511c35-1500-462d-aba9-6ac155440b52","triggerCount":0,"shared":[{"createdAt":"2025-07-04T16:37:20.081Z","updatedAt":"2025-07-04T16:37:20.081Z","role":"workflow:owner","workflowId":"dRuOIWqMXgObmUtg","projectId":"zzPl0J6fgMubUxOk"}],"tags":[{"createdAt":"2025-07-04T16:37:06.670Z","updatedAt":"2025-07-04T16:37:06.670Z","id":"EwW8xgTnD8z217Tm","name":"ИИздец"}]}